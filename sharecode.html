<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CodeSnap · Code Screenshot Generator</title>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- Highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  
  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style>
    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #101622;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s;
    }
    
    /* Light mode */
    body.light-mode {
      background: #f3f4f6;
      color: #111827;
    }
    
    body.light-mode .glass-panel {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    body.light-mode .window {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    body.light-mode .window-code code {
      color: #1f2937;
    }
    
    body.light-mode .language-select {
      background: rgba(0, 0, 0, 0.05);
      color: #1f2937;
    }
    
    body.light-mode textarea {
      background: rgba(0, 0, 0, 0.05);
      color: #1f2937;
    }
    
    body.light-mode .editor-stats {
      color: #6b7280;
    }
    
    body.light-mode .btn-secondary {
      background: #e5e7eb;
      color: #1f2937;
    }
    
    body.light-mode .btn-secondary:hover {
      background: #d1d5db;
    }
    
    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 24px;
      background: rgba(16, 22, 34, 0.8);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: relative;
      z-index: 20;
    }
    
    body.light-mode .header {
      background: rgba(255, 255, 255, 0.8);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: #135bec;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo-icon span {
      color: white;
      font-size: 20px;
    }
    
    .logo-text {
      font-weight: 700;
      font-size: 18px;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .language-switch {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .language-switch .active {
      color: #135bec;
    }
    
    .language-switch .inactive {
      color: #6b7280;
      cursor: pointer;
    }
    
    .language-switch .inactive:hover {
      color: #9ca3af;
    }
    
    .theme-toggle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: transparent;
      border: none;
      color: #9ca3af;
    }
    
    .theme-toggle:hover {
      background: rgba(255,255,255,0.1);
    }
    
    body.light-mode .theme-toggle:hover {
      background: rgba(0,0,0,0.05);
    }
    
    /* Main Content */
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      padding-bottom: 100px;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    
    /* Section Title */
    .section-title {
      font-size: 12px;
      font-weight: 600;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      padding-left: 4px;
    }
    
    /* Preview Card */
    .preview-card {
      background: transparent;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      aspect-ratio: 4/3;
      position: relative;
    }
    
    @media (max-width: 640px) {
      .preview-card {
        aspect-ratio: 3/4;
      }
    }
    
    .preview-content {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: padding 0.3s;
    }
    
    .preview-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom right, #6366f1, #a855f7, #ec4899);
      transition: all 0.5s;
    }
    
    .preview-bg-pattern {
      position: absolute;
      inset: 0;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSIxMDAiPjxyZWN0IHdpZHRoPSI1NiIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNmZmZmZmYiLz48cGF0aCBkPSJNMjggNjZMMCA1MEwwIDE2TDI4IDBMNTYgMTZMNTYgNTBMMjggNjZMMjggMTAwIiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIG9wYWNpdHk9IjAuMSIvPjxwYXRoIGQ9Ik0yOCAwTDI4IDM0TDAgNTBMMCA4NEwyOCAxMDBMNTYgODRMNTYgNTBMMjggMzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZmZmZiIgb3BhY2l0eT0iMC4xIi8+PC9zdmc+');
      opacity: 0.1;
      mix-blend-mode: overlay;
    }
    
    .window {
      width: 100%;
      background: rgba(17, 24, 39, 0.9);
      backdrop-filter: blur(4px);
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }
    
    .window-bar {
      height: 32px;
      background: rgba(255,255,255,0.05);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex;
      align-items: center;
      padding: 0 16px;
    }
    
    .window-dots {
      display: flex;
      gap: 8px;
    }
    
    .window-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    
    .dot-red { background: #ff5f56; }
    .dot-yellow { background: #ffbd2e; }
    .dot-green { background: #27c93f; }
    
    .window-filename {
      flex: 1;
      text-align: center;
      font-size: 10px;
      font-family: 'JetBrains Mono', monospace;
      color: #6b7280;
    }
    
    .window-code {
      padding: 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      line-height: 1.6;
      color: #d1d5db;
      overflow-x: auto;
    }
    
    .window-code pre {
      margin: 0;
    }
    
    .window-code code {
      background: transparent !important;
      padding: 0 !important;
      font-family: 'JetBrains Mono', monospace !important;
    }
    
    /* Glass Panel */
    .glass-panel {
      background: rgba(28, 35, 51, 0.7);
      backdrop-filter: blur(12px);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    /* Editor */
    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .editor-label {
      display: flex;
      align-items: center;
      gap: 4px;
      color: #9ca3af;
      font-size: 12px;
      font-weight: 600;
    }
    
    .editor-label span {
      font-size: 14px;
    }
    
    .editor-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .copy-btn {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      padding: 4px;
    }
    
    .copy-btn:hover {
      color: #135bec;
    }
    
    .language-select {
      background: rgba(0,0,0,0.3);
      border: none;
      color: #d1d5db;
      font-size: 12px;
      padding: 6px 24px 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 4px center;
    }
    
    .language-select option {
      background: #1f2937;
      color: #fff;
    }
    
    textarea {
      width: 100%;
      height: 120px;
      background: rgba(0,0,0,0.3);
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: #d1d5db;
      resize: none;
      outline: none;
    }
    
    textarea:focus {
      outline: 2px solid #135bec;
    }
    
    .editor-stats {
      text-align: right;
      margin-top: 8px;
      font-size: 10px;
      font-family: 'JetBrains Mono', monospace;
      color: #6b7280;
    }
    
    /* Styling Panel */
    .styling-panel {
      background: rgba(28, 35, 51, 0.7);
      backdrop-filter: blur(12px);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .styling-title {
      font-size: 12px;
      font-weight: 600;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 16px;
    }
    
    .control-group {
      margin-bottom: 20px;
    }
    
    .control-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 8px;
      display: block;
    }
    
    .background-selector {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    
    .bg-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    
    .bg-option:hover {
      transform: scale(1.1);
    }
    
    .bg-option.active {
      border-color: white;
      outline: 2px solid white;
      outline-offset: 2px;
    }
    
    .bg-default {
      background: linear-gradient(to bottom right, #6366f1, #a855f7, #ec4899);
    }
    
    .bg-emerald {
      background: linear-gradient(to top right, #10b981, #06b6d4);
    }
    
    .bg-slate {
      background: linear-gradient(to right, #0f172a, #334155);
    }
    
    .bg-orange {
      background: linear-gradient(to bottom left, #f97316, #f43f5e);
    }
    
    .bg-purple {
      background: linear-gradient(to top left, #111827, #581c87, #7c3aed);
    }
    
    .bg-dark {
      background: #1c1917;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .custom-color {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px dashed #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6b7280;
      cursor: pointer;
      position: relative;
      flex-shrink: 0;
    }
    
    .custom-color input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
    }
    
    /* Slider */
    .slider-container {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 8px;
    }
    
    .slider-value {
      font-family: 'JetBrains Mono', monospace;
      color: #6b7280;
    }
    
    input[type=range] {
      width: 100%;
      height: 6px;
      background: #374151;
      border-radius: 9999px;
      appearance: none;
    }
    
    input[type=range]::-webkit-slider-thumb {
      appearance: none;
      width: 18px;
      height: 18px;
      background: #135bec;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid white;
      margin-top: -6px;
    }
    
    /* Toggles */
    .toggles-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 8px;
    }
    
    .toggle-item {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
    }
    
    .toggle-item:hover {
      background: rgba(0,0,0,0.4);
    }
    
    .toggle-label {
      font-size: 12px;
      color: #d1d5db;
    }
    
    .toggle-switch {
      position: relative;
      width: 32px;
      height: 16px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #4b5563;
      border-radius: 34px;
      cursor: pointer;
      transition: 0.2s;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 12px;
      width: 12px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      border-radius: 50%;
      transition: 0.2s;
    }
    
    input:checked + .toggle-slider {
      background-color: #135bec;
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(16px);
    }
    
    /* Bottom Bar */
    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 16px;
      background: rgba(16, 22, 34, 0.9);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255,255,255,0.1);
      z-index: 50;
    }
    
    body.light-mode .bottom-bar {
      background: rgba(255, 255, 255, 0.9);
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .bottom-bar-content {
      max-width: 500px;
      margin: 0 auto;
      display: flex;
      gap: 12px;
    }
    
    .btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn:active {
      transform: scale(0.95);
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
    }
    
    .btn-secondary:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .btn-primary {
      background: #135bec;
      color: white;
      box-shadow: 0 4px 12px rgba(19, 91, 236, 0.3);
    }
    
    .btn-primary:hover {
      background: #0f4bc4;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 24px 0;
      font-size: 12px;
      color: #6b7280;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 8px;
    }
    
    .footer-links a {
      color: inherit;
      text-decoration: none;
    }
    
    .footer-links a:hover {
      color: #135bec;
    }
    
    .copyright {
      font-size: 10px;
      opacity: 0.7;
    }
    
    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      pointer-events: none;
    }
    
    .toast {
      background: #1c2333;
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
      animation: slideUp 0.3s ease, fadeOut 0.3s ease 2.2s forwards;
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      to { opacity: 0; }
    }
    
    /* Hide scrollbar */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <div class="logo-icon">
        <span class="material-icons">code</span>
      </div>
      <span class="logo-text">CodeSnap</span>
    </div>
    
    <div class="header-right">
      <div class="language-switch" id="languageSwitch">
        <span class="active" data-lang="en">EN</span>
        <span>|</span>
        <span class="inactive" data-lang="id">ID</span>
      </div>
      
      <button class="theme-toggle" id="themeToggle">
        <span class="material-icons" id="themeIcon">dark_mode</span>
      </button>
    </div>
  </header>
  
  <!-- Main Content -->
  <main class="main-content no-scrollbar">
    <div class="container">
      
      <!-- Preview Section -->
      <div>
        <div class="section-title" id="previewTitle">Preview</div>
        
        <div id="captureTarget" class="preview-card">
          <div id="previewPadding" class="preview-content" style="padding: 32px;">
            <div id="previewBg" class="preview-bg bg-default"></div>
            <div class="preview-bg-pattern"></div>
            
            <div id="codeWindow" class="window" style="border-radius: 12px;">
              <div class="window-bar">
                <div class="window-dots">
                  <div class="window-dot dot-red"></div>
                  <div class="window-dot dot-yellow"></div>
                  <div class="window-dot dot-green"></div>
                </div>
                <div id="filenameDisplay" class="window-filename">snippet.js</div>
              </div>
              
              <div class="window-code">
                <pre><code id="codeContent" class="language-javascript">const generate = () => {
  const design = "Awesome";
  return render(design);
}</code></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Editor Section -->
      <div class="glass-panel">
        <div class="editor-header">
          <div class="editor-label" id="editorLabel">
            <span class="material-icons">edit</span>
            <span id="editorText">Editor</span>
          </div>
          <div class="editor-actions">
            <button id="copyCodeBtn" class="copy-btn" title="Copy code">
              <span class="material-icons" style="font-size: 14px;">content_copy</span>
            </button>
            <select id="languageSelect" class="language-select">
              <option value="javascript">JavaScript</option>
              <option value="html">HTML</option>
              <option value="css">CSS</option>
              <option value="python">Python</option>
              <option value="json">JSON</option>
            </select>
          </div>
        </div>
        
        <textarea id="editor" spellcheck="false">const generate = () => {
  const design = "Awesome";
  return render(design);
}</textarea>
        
        <div id="editorStats" class="editor-stats">3 lines, 82 chars</div>
      </div>
      
      <!-- Styling Panel -->
      <div class="styling-panel">
        <div class="styling-title" id="stylingTitle">Styling</div>
        
        <!-- Background Selector -->
        <div class="control-group">
          <div class="control-label" id="backgroundLabel">Background</div>
          <div class="background-selector no-scrollbar" id="bgControls">
            <div class="bg-option bg-default active" data-bg="bg-default" title="Sunset"></div>
            <div class="bg-option bg-emerald" data-bg="bg-emerald" title="Ocean"></div>
            <div class="bg-option bg-slate" data-bg="bg-slate" title="Dark"></div>
            <div class="bg-option bg-orange" data-bg="bg-orange" title="Sunrise"></div>
            <div class="bg-option bg-purple" data-bg="bg-purple" title="Purple Night"></div>
            <div class="bg-option bg-dark" data-bg="bg-dark" title="Charcoal"></div>
            
            <div class="custom-color">
              <input type="color" id="customColorPicker" value="#3b82f6">
              <span class="material-icons">add</span>
            </div>
          </div>
        </div>
        
        <!-- Padding Slider -->
        <div class="control-group">
          <div class="slider-container">
            <span class="control-label" id="paddingLabel">Padding</span>
            <span id="paddingValue" class="slider-value">32px</span>
          </div>
          <input type="range" id="paddingSlider" min="16" max="128" value="32">
        </div>
        
        <!-- Corner Radius Slider -->
        <div class="control-group">
          <div class="slider-container">
            <span class="control-label" id="radiusLabel">Corner Radius</span>
            <span id="radiusValue" class="slider-value">12px</span>
          </div>
          <input type="range" id="radiusSlider" min="0" max="32" value="12">
        </div>
        
        <!-- Toggles -->
        <div class="toggles-grid">
          <div class="toggle-item">
            <span class="toggle-label" id="shadowLabel">Shadow</span>
            <label class="toggle-switch">
              <input type="checkbox" id="shadowToggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="toggle-item">
            <span class="toggle-label" id="darkWindowLabel">Dark Window</span>
            <label class="toggle-switch">
              <input type="checkbox" id="darkWindowToggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <footer class="footer">
        <div class="footer-links">
          <a href="#" id="privacyLink">Privacy Policy</a>
          <span>•</span>
          <a href="#" id="termsLink">Terms & Conditions</a>
        </div>
        <div class="copyright" id="copyright">© 2026 CodeSnap. All rights reserved.</div>
      </footer>
    </div>
  </main>
  
  <!-- Bottom Bar -->
  <div class="bottom-bar">
    <div class="bottom-bar-content">
      <button id="copyImageBtn" class="btn btn-secondary">
        <span class="material-icons">content_copy</span>
        <span id="copyImageText">Copy Image</span>
      </button>
      <button id="exportBtn" class="btn btn-primary">
        <span class="material-icons">download</span>
        <span id="exportText">Export PNG</span>
      </button>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>
  
  <script>
    // Initialize
    const state = {
      code: `const generate = () => {\n  const design = "Awesome";\n  return render(design);\n}`,
      language: 'javascript',
      padding: 32,
      radius: 12,
      hasShadow: true,
      isDarkWindow: true,
      currentLang: 'en'
    };
    
    // DOM Elements
    const editor = document.getElementById('editor');
    const codeContent = document.getElementById('codeContent');
    const filenameDisplay = document.getElementById('filenameDisplay');
    const languageSelect = document.getElementById('languageSelect');
    const editorStats = document.getElementById('editorStats');
    const paddingSlider = document.getElementById('paddingSlider');
    const paddingValue = document.getElementById('paddingValue');
    const radiusSlider = document.getElementById('radiusSlider');
    const radiusValue = document.getElementById('radiusValue');
    const previewPadding = document.getElementById('previewPadding');
    const codeWindow = document.getElementById('codeWindow');
    const previewBg = document.getElementById('previewBg');
    const shadowToggle = document.getElementById('shadowToggle');
    const darkWindowToggle = document.getElementById('darkWindowToggle');
    const copyCodeBtn = document.getElementById('copyCodeBtn');
    const copyImageBtn = document.getElementById('copyImageBtn');
    const exportBtn = document.getElementById('exportBtn');
    const toastContainer = document.getElementById('toastContainer');
    const customColorPicker = document.getElementById('customColorPicker');
    const bgOptions = document.querySelectorAll('.bg-option');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const langEN = document.querySelector('[data-lang="en"]');
    const langID = document.querySelector('[data-lang="id"]');
    
    // Translation object
    const translations = {
      en: {
        preview: 'Preview',
        editor: 'Editor',
        styling: 'Styling',
        background: 'Background',
        padding: 'Padding',
        radius: 'Corner Radius',
        shadow: 'Shadow',
        darkWindow: 'Dark Window',
        copyImage: 'Copy Image',
        export: 'Export PNG',
        privacy: 'Privacy Policy',
        terms: 'Terms & Conditions',
        copyright: '© 2026 CodeSnap. All rights reserved.'
      },
      id: {
        preview: 'Pratinjau',
        editor: 'Editor',
        styling: 'Gaya',
        background: 'Latar Belakang',
        padding: 'Jarak',
        radius: 'Sudut',
        shadow: 'Bayangan',
        darkWindow: 'Jendela Gelap',
        copyImage: 'Salin Gambar',
        export: 'Ekspor PNG',
        privacy: 'Kebijakan Privasi',
        terms: 'Syarat & Ketentuan',
        copyright: '© 2026 CodeSnap. Hak cipta dilindungi.'
      }
    };
    
    // Set initial values
    editor.value = state.code;
    updatePreview();
    updateStats();
    updateFilename();
    
    // Set initial window styles
    codeWindow.style.borderRadius = state.radius + 'px';
    if (state.hasShadow) {
      codeWindow.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.5)';
    }
    
    // ========== BACKGROUND SELECTOR ==========
    bgOptions.forEach(option => {
      option.addEventListener('click', function() {
        // Remove active class from all
        bgOptions.forEach(opt => opt.classList.remove('active'));
        
        // Add active class to clicked
        this.classList.add('active');
        
        // Get background class
        const bgClass = this.dataset.bg;
        
        // Reset custom color
        previewBg.style.background = '';
        
        // Apply gradient class
        previewBg.className = 'preview-bg ' + bgClass;
      });
    });
    
    // Custom color picker
    customColorPicker.addEventListener('input', (e) => {
      const color = e.target.value;
      
      // Remove active from all bg options
      bgOptions.forEach(opt => opt.classList.remove('active'));
      
      // Apply custom color
      previewBg.className = 'preview-bg';
      previewBg.style.background = color;
    });
    
    // ========== EDITOR ==========
    editor.addEventListener('input', (e) => {
      state.code = e.target.value;
      updatePreview();
      updateStats();
    });
    
    languageSelect.addEventListener('change', (e) => {
      state.language = e.target.value;
      updateFilename();
      updatePreview();
    });
    
    // ========== SLIDERS ==========
    paddingSlider.addEventListener('input', (e) => {
      state.padding = parseInt(e.target.value);
      paddingValue.textContent = state.padding + 'px';
      previewPadding.style.padding = state.padding + 'px';
    });
    
    radiusSlider.addEventListener('input', (e) => {
      state.radius = parseInt(e.target.value);
      radiusValue.textContent = state.radius + 'px';
      codeWindow.style.borderRadius = state.radius + 'px';
    });
    
    // ========== TOGGLES ==========
    shadowToggle.addEventListener('change', (e) => {
      state.hasShadow = e.target.checked;
      if (state.hasShadow) {
        codeWindow.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.5)';
      } else {
        codeWindow.style.boxShadow = 'none';
      }
    });
    
    darkWindowToggle.addEventListener('change', (e) => {
      state.isDarkWindow = e.target.checked;
      updateWindowTheme();
    });
    
    // ========== THEME TOGGLE ==========
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      themeIcon.textContent = isLight ? 'light_mode' : 'dark_mode';
      updateWindowTheme();
    });
    
    function updateWindowTheme() {
      if (state.isDarkWindow) {
        if (document.body.classList.contains('light-mode')) {
          codeWindow.style.background = 'rgba(255, 255, 255, 0.95)';
          codeWindow.style.border = '1px solid rgba(0,0,0,0.1)';
          codeContent.style.color = '#1f2937';
        } else {
          codeWindow.style.background = 'rgba(17, 24, 39, 0.9)';
          codeWindow.style.border = '1px solid rgba(255,255,255,0.1)';
          codeContent.style.color = '#d1d5db';
        }
      } else {
        if (document.body.classList.contains('light-mode')) {
          codeWindow.style.background = '#ffffff';
          codeWindow.style.border = '1px solid #e5e7eb';
          codeContent.style.color = '#1f2937';
        } else {
          codeWindow.style.background = '#1f2937';
          codeWindow.style.border = '1px solid #374151';
          codeContent.style.color = '#d1d5db';
        }
      }
    }
    
    // ========== LANGUAGE SWITCH ==========
    langEN.addEventListener('click', () => {
      setLanguage('en');
    });
    
    langID.addEventListener('click', () => {
      setLanguage('id');
    });
    
    function setLanguage(lang) {
      state.currentLang = lang;
      
      // Update active state
      if (lang === 'en') {
        langEN.classList.add('active');
        langEN.classList.remove('inactive');
        langID.classList.remove('active');
        langID.classList.add('inactive');
      } else {
        langID.classList.add('active');
        langID.classList.remove('inactive');
        langEN.classList.remove('active');
        langEN.classList.add('inactive');
      }
      
      // Update UI text
      document.getElementById('previewTitle').textContent = translations[lang].preview;
      document.getElementById('editorText').textContent = translations[lang].editor;
      document.getElementById('stylingTitle').textContent = translations[lang].styling;
      document.getElementById('backgroundLabel').textContent = translations[lang].background;
      document.getElementById('paddingLabel').textContent = translations[lang].padding;
      document.getElementById('radiusLabel').textContent = translations[lang].radius;
      document.getElementById('shadowLabel').textContent = translations[lang].shadow;
      document.getElementById('darkWindowLabel').textContent = translations[lang].darkWindow;
      document.getElementById('copyImageText').textContent = translations[lang].copyImage;
      document.getElementById('exportText').textContent = translations[lang].export;
      document.getElementById('privacyLink').textContent = translations[lang].privacy;
      document.getElementById('termsLink').textContent = translations[lang].terms;
      document.getElementById('copyright').textContent = translations[lang].copyright;
      
      showToast(`Language switched to ${lang === 'en' ? 'English' : 'Indonesia'}`);
    }
    
    // ========== COPY CODE ==========
    copyCodeBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(state.code).then(() => {
        showToast(state.currentLang === 'en' ? 'Code copied!' : 'Kode disalin!');
      });
    });
    
    // ========== EXPORT PNG ==========
    exportBtn.addEventListener('click', async () => {
      exportBtn.disabled = true;
      const originalText = exportBtn.innerHTML;
      exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (state.currentLang === 'en' ? 'Exporting...' : 'Mengekspor...');
      
      try {
        const canvas = await html2canvas(document.getElementById('captureTarget'), {
          scale: 2,
          backgroundColor: null,
          logging: false,
          allowTaint: false,
          useCORS: true
        });
        
        const link = document.createElement('a');
        link.download = `codesnap-${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        showToast(state.currentLang === 'en' ? 'PNG exported!' : 'PNG diekspor!');
      } catch (err) {
        console.error(err);
        showToast(state.currentLang === 'en' ? 'Export failed' : 'Gagal mengekspor', 'error');
      } finally {
        setTimeout(() => {
          exportBtn.disabled = false;
          exportBtn.innerHTML = originalText;
        }, 500);
      }
    });
    
    // ========== COPY IMAGE ==========
    copyImageBtn.addEventListener('click', async () => {
      copyImageBtn.disabled = true;
      const originalText = copyImageBtn.innerHTML;
      copyImageBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (state.currentLang === 'en' ? 'Copying...' : 'Menyalin...');
      
      try {
        const canvas = await html2canvas(document.getElementById('captureTarget'), {
          scale: 2,
          backgroundColor: null,
          logging: false
        });
        
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png', 1));
        await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
        
        showToast(state.currentLang === 'en' ? 'Image copied!' : 'Gambar disalin!');
      } catch (err) {
        console.error(err);
        showToast(state.currentLang === 'en' ? 'Copy failed' : 'Gagal menyalin', 'error');
      } finally {
        setTimeout(() => {
          copyImageBtn.disabled = false;
          copyImageBtn.innerHTML = originalText;
        }, 500);
      }
    });
    
    // ========== HELPER FUNCTIONS ==========
    function updatePreview() {
      if (window.hljs) {
        try {
          const highlighted = hljs.highlight(state.code, { language: state.language }).value;
          codeContent.innerHTML = highlighted;
        } catch (e) {
          codeContent.innerHTML = escapeHtml(state.code);
        }
      }
      codeContent.className = `language-${state.language}`;
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function updateStats() {
      const lines = state.code.split('\n').length;
      const chars = state.code.length;
      editorStats.textContent = `${lines} lines, ${chars} chars`;
    }
    
    function updateFilename() {
      const extensions = { 
        javascript: 'js', 
        html: 'html', 
        css: 'css', 
        python: 'py', 
        json: 'json' 
      };
      filenameDisplay.textContent = `snippet.${extensions[state.language] || 'txt'}`;
    }
    
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = 'toast';
      
      const icon = type === 'success' ? 'check_circle' : 'error';
      const color = type === 'success' ? '#22c55e' : '#ef4444';
      
      toast.innerHTML = `<span class="material-icons" style="color: ${color};">${icon}</span> ${message}`;
      toastContainer.appendChild(toast);
      
      setTimeout(() => toast.remove(), 3000);
    }
  </script>
</body>
</html>
