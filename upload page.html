<!-- FINAL UPGRADE: Optikl 1:1 with localStorage, progress %, speed, animation, basic security -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optikl Upload</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#000;--card:#0b0b0b;--border:#1f2937;--text:#e5e7eb;
  --muted:#9ca3af;--green:#22c55e;--red:#ef4444;
}
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{margin:0;background:#000;color:var(--text)}
header{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between}
.logo{color:var(--green);font-weight:700;font-size:22px}
.container{max-width:460px;margin:32px auto;padding:0 16px}
.dropzone{background:#050505;border:2px dashed var(--border);border-radius:22px;padding:38px 20px;text-align:center;transition:.25s}
.dropzone:hover{border-color:var(--green);box-shadow:0 0 18px #22c55e22}
.progress-wrap{display:none;margin-bottom:14px}
.progress-text{font-size:13px;color:var(--muted);margin-bottom:6px}
.progress-bar{width:100%;height:6px;background:#020202;border-radius:6px;overflow:hidden}
.progress-inner{height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#4ade80);transition:width .2s}
.result{margin-top:26px;background:var(--card);border-radius:22px;padding:20px;text-align:center;animation:fade .4s}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}
.url-box{margin-top:14px;background:#020202;border:1px solid var(--border);padding:10px;border-radius:14px;font-size:13px;word-break:break-all}
.actions button{margin:6px;border-radius:14px;border:none;padding:10px 14px}
.copy{background:#111827;color:#fff}
.info{background:#065f46;color:#fff}
.delete{background:#7f1d1d;color:#fff}
.history{margin-top:30px;background:var(--card);border-radius:20px;padding:18px}
.item{display:flex;justify-content:space-between;font-size:14px;margin-bottom:8px}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#111827;padding:12px 18px;border-radius:14px;display:none}
</style>
</head>
<body>
<header><div class="logo">Optikl</div></header>
<div class="container">
<div class="dropzone" id="dropzone">
<div class="progress-wrap" id="progressWrap">
<div class="progress-text" id="progressText">Uploading...</div>
<div class="progress-bar"><div class="progress-inner" id="progressInner"></div></div>
</div>
<h2>Drag & Drop or Click to Upload</h2>
<p style="color:var(--muted)">Max 100MB</p>
<button onclick="fileInput.click()">Select File</button>
<input type="file" id="fileInput" hidden>
</div>
<div id="result"></div>
<div class="history"><b>Upload History</b><div id="historyList"></div></div>
</div>
<div class="toast" id="toast"></div>
<div id="modal" style="display:none;position:fixed;inset:0;background:#000a;align-items:center;justify-content:center">
  <div style="background:#0b0b0b;padding:20px;border-radius:18px;width:280px;text-align:center">
    <h3>Delete file?</h3>
    <p style="color:#9ca3af;font-size:13px">This action cannot be undone</p>
    <div style="margin-top:16px">
      <button onclick="closeModal()">Cancel</button>
      <button style="background:#7f1d1d;color:#fff" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>
<input id="search" placeholder="Search history" style="width:100%;margin-top:14px;padding:8px;border-radius:12px;border:1px solid #1f2937;background:#020202;color:#fff">
<script>
const fileInput=document.getElementById('fileInput');
const dropzone=document.getElementById('dropzone');
const progressWrap=document.getElementById('progressWrap');
const progressInner=document.getElementById('progressInner');
const progressText=document.getElementById('progressText');
const historyList=document.getElementById('historyList');
const result=document.getElementById('result');
const toast=document.getElementById('toast');
let pendingUndo=null;
let deleteTarget=null;
let deleteTargetId=null;
let lastLoaded=0;let lastTime=Date.now();

loadHistory();
fileInput.onchange=()=>upload(fileInput.files[0]);
dropzone.ondragover=e=>e.preventDefault();
dropzone.ondrop=e=>{e.preventDefault();upload(e.dataTransfer.files[0])};

function upload(file){
 lastLoaded=0;lastTime=Date.now();
 if(!file||file.size>100*1024*1024){showToast('Invalid file');return}
 const formData=new FormData();formData.append('file',file);
 progressWrap.style.display='block';
 const xhr=new XMLHttpRequest();xhr.open('POST','https://api.botzaku.eu.org/api/upload');
 xhr.upload.onprogress=e=>{
  if(!e.lengthComputable) return;
  progressWrap.style.display='block';
  const percent=Math.floor((e.loaded/e.total)*100);
  const now=Date.now();
  const speed=((e.loaded-lastLoaded)/1024/((now-lastTime)/1000||1)).toFixed(1);
  lastLoaded=e.loaded;lastTime=now;
  progressInner.style.width=percent+'%';
  progressText.textContent=`${percent}% • ${speed} KB/s`;
};
 xhr.onload=()=>{
  progressInner.style.width='100%';
  progressWrap.style.display='none';
  const data=JSON.parse(xhr.responseText);
  if(!data.success){showToast('Upload failed');return}
  showResult(data.file);
  saveHistory(data.file);
  showToast('Upload completed');
 };
 xhr.onerror=()=>{progressWrap.style.display='none';showToast('Upload error')};
 xhr.send(formData);
}

function showResult(f){
 result.innerHTML=`<div class="result"><h3>Upload Successful</h3><div>${f.name}</div><div class="url-box">${f.url}</div><div class="actions"><button class="copy" onclick="copy('${f.url}')">Copy</button><button class="info" onclick="window.open('${f.infoUrl}')">Info</button><button class="delete" onclick="deleteFile('${f.deleteUrl}','${f.id}')">Delete</button></div></div>`;
}

function saveHistory(f){
 const h=JSON.parse(localStorage.getItem('uploads')||'[]');
 h.unshift(f);localStorage.setItem('uploads',JSON.stringify(h));
 renderHistory();
}
function loadHistory(){renderHistory()}
function renderHistory(){
  historyList.innerHTML='';
  const q=(document.getElementById('search')?.value||'').toLowerCase();
  let h=JSON.parse(localStorage.getItem('uploads')||'[]');

  h.filter(f=>f.name.toLowerCase().includes(q)).forEach(f=>{
    const d=document.createElement('div');
    d.className='item';
    d.innerHTML=`
      <span>${f.name}</span>
      <div>
        <button onclick="copy('${f.url}')">Copy</button>
        <button class="delete" style="margin-left:6px" onclick="deleteFile('${f.deleteUrl}','${f.id}')">Delete</button>
      </div>`;
    historyList.appendChild(d);
  });
}

document.getElementById('search').oninput=renderHistory;</span>
     <div>
       <button onclick=\"copy('${f.url}')\">Copy</button>
       <button style=\"margin-left:6px;background:#7f1d1d;color:#fff;border:none;border-radius:10px;padding:4px 8px\" onclick=\"deleteFile('${f.deleteUrl}','${f.id}')\">Delete</button>
     </div>`;
   historyList.appendChild(d);
 });
}</span><button onclick="copy('${f.url}')">Copy</button>`;historyList.appendChild(d)})
}
function deleteFile(url,id){
 deleteTarget=url;deleteTargetId=id;
 document.getElementById('modal').style.display='flex';
}
function closeModal(){document.getElementById('modal').style.display='none'}
function confirmDelete(){
 fetch(deleteTarget).then(r=>r.json()).then(d=>{
  if(d.success){
    const h=JSON.parse(localStorage.getItem('uploads')||'[]');
    const removed=h.find(f=>f.id===deleteTargetId);
    const rest=h.filter(f=>f.id!==deleteTargetId);
    localStorage.setItem('uploads',JSON.stringify(rest));
    renderHistory();result.innerHTML='';
    pendingUndo=removed;
    showToast('File deleted • Undo');
    setTimeout(()=>pendingUndo=null,5000);
  }
  closeModal();
 })
}url,id){fetch(url).then(r=>r.json()).then(d=>{if(d.success){const h=JSON.parse(localStorage.getItem('uploads')||'[]').filter(f=>f.id!==id);localStorage.setItem('uploads',JSON.stringify(h));renderHistory();result.innerHTML='';showToast('File deleted')}})
}
function copy(t){navigator.clipboard.writeText(t).then(()=>showToast('Link copied'))}
function showToast(t){toast.textContent=t;toast.style.display='block';setTimeout(()=>toast.style.display='none',2200)}
</script>
</body>
</html>
