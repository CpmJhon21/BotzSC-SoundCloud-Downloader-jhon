<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Optikl Upload</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#000000;
  --card:#0b0b0b;
  --border:#1f2937;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --green:#22c55e;
  --red:#ef4444;
}
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{margin:0;background:#000;color:var(--text)}
header{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
header .logo{color:var(--green);font-weight:700;font-size:22px}
header .menu{font-size:26px;color:var(--green)}
.container{max-width:460px;margin:32px auto;padding:0 16px}
.dropzone{background:#050505;border:2px dashed var(--border);border-radius:22px;padding:38px 20px;text-align:center}
.dropzone h2{margin:14px 0 6px;font-size:22px}
.dropzone p{margin:0;color:var(--muted)}
.btn{margin-top:18px;background:#111827;border:none;color:#fff;padding:12px 22px;border-radius:14px;font-size:15px}
.result{margin-top:26px;background:var(--card);border-radius:22px;padding:20px;text-align:center}
.result h2{color:var(--green);margin:0 0 8px}
.preview img{max-width:100%;border-radius:16px;margin-top:16px}
.url-box{margin-top:14px;background:#020202;border:1px solid var(--border);padding:10px;border-radius:14px;font-size:13px;word-break:break-all}
.actions{margin-top:14px;display:flex;gap:10px;justify-content:center}
.actions button{border:none;border-radius:14px;padding:10px 14px;font-size:14px}
.copy{background:#111827;color:#fff}
.info{background:#065f46;color:#fff}
.delete{background:#7f1d1d;color:#fff}
.history{margin-top:30px;background:var(--card);border-radius:20px;padding:18px}
.history h3{margin:0 0 12px}
.item{display:flex;justify-content:space-between;align-items:center;font-size:14px;margin-bottom:10px}
footer{margin:60px 0 24px;text-align:center;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<header>
  <div class="logo">Optikl</div>
  <div class="menu">☰</div>
</header>

<div class="container">
  <div class="dropzone" id="dropzone">
    <div id="progressBar" style="display:none;width:100%;height:6px;background:#020202;border-radius:6px;overflow:hidden;margin-bottom:14px">
      <div id="progressInner" style="height:100%;width:0%;background:#22c55e;transition:width .2s"></div>
    </div>
    ⬆️
    <h2>Drag & Drop or Click to Upload</h2>
    <p>Max 100MB</p>
    <button class="btn" onclick="fileInput.click()">Select File</button>
    <input type="file" id="fileInput" hidden />
  </div>

  <div id="result"></div>

  <div class="history">
    <h3>Upload History</h3>
    <div id="historyList"></div>
  </div>
</div>

<footer>© 2025 Optikl Style</footer>

<!-- DELETE MODAL -->
<div id="deleteModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:50">
  <div style="background:#0b0b0b;border-radius:18px;padding:22px;width:90%;max-width:320px;text-align:center">
    <h3 style="color:#22c55e;margin-top:0">Delete File?</h3>
    <p style="color:#9ca3af;font-size:14px">This file will be permanently deleted.</p>
    <div style="display:flex;gap:10px;justify-content:center;margin-top:16px">
      <button id="cancelDelete" style="background:#1f2937;color:#fff;border:none;border-radius:12px;padding:10px 16px">Cancel</button>
      <button id="confirmDelete" style="background:#7f1d1d;color:#fff;border:none;border-radius:12px;padding:10px 16px">Delete</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" style="position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:12px 18px;border-radius:14px;font-size:14px;display:none;z-index:60"></div>

<script>
const fileInput=document.getElementById('fileInput');
const progressBar=document.getElementById('progressBar');
const progressInner=document.getElementById('progressInner');
const dropzone=document.getElementById('dropzone');
const result=document.getElementById('result');
const historyList=document.getElementById('historyList');

const deleteModal=document.getElementById('deleteModal');
const confirmDelete=document.getElementById('confirmDelete');
const cancelDelete=document.getElementById('cancelDelete');
const toast=document.getElementById('toast');

let deleteUrlTarget='';
let deleteBtnTarget=null;

fileInput.onchange=()=>upload(fileInput.files[0]);
dropzone.ondragover=e=>e.preventDefault();
dropzone.ondrop=e=>{e.preventDefault();upload(e.dataTransfer.files[0])};

function upload(file){
  if(!file) return;
  const formData=new FormData();
  formData.append('file',file);

  const xhr=new XMLHttpRequest();
  xhr.open('POST','https://api.botzaku.eu.org/api/upload');
  xhr.upload.onprogress=e=>{
    if(e.lengthComputable){
      progressBar.style.display='block';
      progressInner.style.width=((e.loaded/e.total)*100)+'%';
    }
  };
  xhr.onload=()=>{
    progressInner.style.width='100%';
    setTimeout(()=>progressBar.style.display='none',500);
    const data=JSON.parse(xhr.responseText);
    if(!data.success){showToast(data.message||'Upload failed');return;}
    const f=data.file;
    showResult(f);
    addHistory(f);
    showToast('Upload completed');
  };
  xhr.onerror=()=>{progressBar.style.display='none';showToast('Upload failed')};
  xhr.send(formData);
}

function upload(file){
  if(!file) return;
  progressInner.style.width='0%';
  const formData=new FormData();
  formData.append('file',file);

  // start upload
  (()=>showToast('Upload error'));
}

function showResult(f){
  result.innerHTML=`
  <div class="result">
    <h2>Upload Successful</h2>
    <p>${f.name} • ${f.size}</p>
    <div class="preview"><img src="${f.url}"></div>
    <div class="url-box">${f.url}</div>
    <div class="actions">
      <button class="copy" onclick="copy('${f.url}')">Copy</button>
      <button class="info" onclick="window.open('${f.infoUrl}')">Info</button>
      <button class="delete" onclick="openDeleteModal('${f.deleteUrl}', this)">Delete</button>
    </div>
  </div>`;
}

function addHistory(f){
  const d=document.createElement('div');
  d.className='item';
  d.dataset.fileId=f.id;
  d.innerHTML=`<span>${f.name}</span><button class="copy" onclick="copy('${f.url}')">Copy</button>`;
  historyList.prepend(d);
}

function removeHistoryById(id){
  const item=[...historyList.children].find(i=>i.dataset.fileId===id);
  if(item) item.remove();
}

function addHistory(f){
  const d=document.createElement('div');
  d.className='item';
  d.innerHTML=`<span>${f.name}</span><button class="copy" onclick="copy('${f.url}')">Copy</button>`;
  historyList.prepend(d);
}

function copy(t){navigator.clipboard.writeText(t).then(()=>showToast('Link copied'))}

function openDeleteModal(url, btn){
  deleteUrlTarget=url;
  deleteBtnTarget=btn;
  deleteModal.style.display='flex';
}

cancelDelete.onclick=()=>deleteModal.style.display='none';

confirmDelete.onclick=()=>{
  fetch(deleteUrlTarget)
    .then(r=>r.json())
    .then(data=>{
      if(data.success){
        showToast('File deleted');
        result.innerHTML='';
        removeHistoryById(deleteFileId);
      }else{
        showToast(data.message||'Delete failed');
      }
      deleteModal.style.display='none';
    })
    .catch(()=>{showToast('Delete error');deleteModal.style.display='none';});
};

function showToast(msg){
  toast.textContent=msg;
  toast.style.display='block';
  setTimeout(()=>toast.style.display='none',2500);
}
</script>
</body>
</html>
